{"ast":null,"code":"import _regeneratorRuntime from\"/Users/wuyubao/Desktop/vscode-web/React-app/react-blog/client/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/Users/wuyubao/Desktop/vscode-web/React-app/react-blog/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/wuyubao/Desktop/vscode-web/React-app/react-blog/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useLocation}from'react-router-dom';import{useEffect,useState}from'react';import axios from'axios';import'./singlePost.css';import{Link}from'react-router-dom';import{Context}from'../../context/Context';import{useContext}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export default function SinglePost(){var location=useLocation();var path=location.pathname.split('/')[2];var _useState=useState({}),_useState2=_slicedToArray(_useState,2),post=_useState2[0],setPost=_useState2[1];var PF=\"http://localhost:5000/images/\";var _useContext=useContext(Context),user=_useContext.user;var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),title=_useState4[0],setTitle=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),desc=_useState6[0],setDesc=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),updateMode=_useState8[0],setUpdateMode=_useState8[1];useEffect(function(){var getPost=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return axios.get('/posts/'+path);case 2:res=_context.sent;setPost(res.data);setTitle(res.data.title);setDesc(res.data.desc);case 6:case\"end\":return _context.stop();}}},_callee);}));return function getPost(){return _ref.apply(this,arguments);};}();getPost();},[path]);var handleDelete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var res;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return axios.delete('/posts/'+path,{data:{username:user===null||user===void 0?void 0:user.username}});case 3:res=_context2.sent;window.location.replace('/');_context2.next=9;break;case 7:_context2.prev=7;_context2.t0=_context2[\"catch\"](0);case 9:case\"end\":return _context2.stop();}}},_callee2,null,[[0,7]]);}));return function handleDelete(){return _ref2.apply(this,arguments);};}();var handleUpdate=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return axios.put('/posts/'+path,{username:user.username,title:title,desc:desc});case 3:// window.location.reload();\nsetUpdateMode(false);_context3.next=8;break;case 6:_context3.prev=6;_context3.t0=_context3[\"catch\"](0);case 8:case\"end\":return _context3.stop();}}},_callee3,null,[[0,6]]);}));return function handleUpdate(){return _ref3.apply(this,arguments);};}();return/*#__PURE__*/_jsx(\"div\",{className:\"singlePost\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"singlePostWrapper\",children:[post.photo&&/*#__PURE__*/_jsx(\"img\",{src:PF+post.photo,alt:\"\",className:\"singlePostImg\"}),updateMode?/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:title,className:\"singlePostInput\",autoFocus:true,onChange:function onChange(e){return setTitle(e.target.value);}}):/*#__PURE__*/_jsxs(\"h1\",{className:\"singlePostTitle\",children:[title,post.username===(user===null||user===void 0?void 0:user.username)&&/*#__PURE__*/_jsxs(\"div\",{className:\"singlePostEdit\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"singlePostIcon far fa-edit\",onClick:function onClick(e){return setUpdateMode(true);}}),/*#__PURE__*/_jsx(\"i\",{className:\"singlePostIcon far fa-trash-alt\",onClick:handleDelete})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"singlePostInfo\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"singlePostAuthor\",children:[\"Author: \",/*#__PURE__*/_jsx(Link,{to:\"/?user=\".concat(post.username),className:\"link\",children:/*#__PURE__*/_jsx(\"b\",{children:post.username})}),\" \"]}),/*#__PURE__*/_jsx(\"span\",{className:\"singlePostDate\",children:new Date(post.createdAt).toDateString()})]}),updateMode?/*#__PURE__*/_jsx(\"textarea\",{className:\"singlePostDescInput\",value:desc,onChange:function onChange(e){return setDesc(e.target.value);}}):/*#__PURE__*/_jsx(\"p\",{className:\"singlePostDesc\",children:desc}),updateMode&&/*#__PURE__*/_jsx(\"button\",{className:\"singlePostButton\",onClick:handleUpdate,children:\"update\"})]})});}","map":{"version":3,"sources":["/Users/wuyubao/Desktop/vscode-web/React-app/react-blog/client/src/components/singlePost/SinglePost.jsx"],"names":["useLocation","useEffect","useState","axios","Link","Context","useContext","SinglePost","location","path","pathname","split","post","setPost","PF","user","title","setTitle","desc","setDesc","updateMode","setUpdateMode","getPost","get","res","data","handleDelete","delete","username","window","replace","handleUpdate","put","photo","e","target","value","Date","createdAt","toDateString"],"mappings":"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","sourcesContent":["import { useLocation } from 'react-router-dom'\nimport { useEffect, useState } from 'react';\nimport axios from 'axios';\nimport './singlePost.css';\nimport { Link } from 'react-router-dom';\nimport { Context } from '../../context/Context';\nimport { useContext } from 'react';\n\nexport default function SinglePost() {\n    const location = useLocation();\n    const path = location.pathname.split('/')[2];\n    const [post, setPost] = useState({});\n    const PF = \"http://localhost:5000/images/\";\n    const { user } = useContext(Context)\n\n    const [title, setTitle] = useState('');\n    const [desc, setDesc] = useState('');\n    const [updateMode, setUpdateMode] = useState(false);\n\n\n    useEffect(() => {\n        const getPost = async () => {\n            const res = await axios.get('/posts/' + path);\n            setPost(res.data);\n            setTitle(res.data.title);\n            setDesc(res.data.desc);\n        };\n\n        getPost();\n    }, [path])\n\n    const handleDelete = async () => {\n        try {\n            const res = await axios.delete('/posts/' + path, { data: { username: user?.username } });\n            window.location.replace('/');\n        } catch (err) {\n\n        }\n    }\n\n    const handleUpdate = async () => {\n        try {\n            await axios.put('/posts/'+path,{\n                username:user.username,\n                title,\n                desc\n            });\n\n            // window.location.reload();\n            setUpdateMode(false);\n        } catch (err) {\n            \n        }\n    }\n\n    return (\n        <div className='singlePost'>\n            <div className=\"singlePostWrapper\">\n                {post.photo && (\n                    <img src={PF + post.photo} alt=\"\" className=\"singlePostImg\" />\n                )}\n\n                {updateMode ? (<input type=\"text\" value={title} className='singlePostInput' autoFocus onChange={e => setTitle(e.target.value)} />) : (<h1 className=\"singlePostTitle\">\n                    {title}\n                    {post.username === user?.username && (\n                        <div className=\"singlePostEdit\">\n                            <i className=\"singlePostIcon far fa-edit\" onClick={e => setUpdateMode(true)}></i>\n                            <i className=\"singlePostIcon far fa-trash-alt\" onClick={handleDelete}></i>\n                        </div>\n                    )}\n\n                </h1>)}\n\n\n                <div className=\"singlePostInfo\">\n                    <span className='singlePostAuthor'>Author: <Link to={`/?user=${post.username}`} className='link'><b>{post.username}</b></Link> </span>\n                    <span className='singlePostDate'>{new Date(post.createdAt).toDateString()}</span>\n                </div>\n\n                {updateMode ? <textarea className='singlePostDescInput' value={desc} onChange={e=>setDesc(e.target.value)}></textarea> : <p className='singlePostDesc'>\n                    {desc}\n                </p>}\n\n                {updateMode && <button className='singlePostButton' onClick={handleUpdate}>update</button>}\n\n            </div>\n        </div>\n    )\n}\n"]},"metadata":{},"sourceType":"module"}